## 从输入`URL`到页面加载完成，发生了什么？

如下图所示，当在浏览器地址栏输入一个地址的时候，发生了什么呢

![20200407214919](https://raw.githubusercontent.com/yayxs/Pics/master/img/20200407214919.png)

### `导航`流程

- 浏览器进程收到用户输入的 URL 请求
  - 浏览器进程将 URL 转发给网络进程
- 在网络进程中发起真正的 URL 请求
- 网络进程接收到了额响应头的数据
  - 解析响应头的数据
  - 将数据转发给浏览器进程
- 浏览器接到网络进程的响应头之后 发送提交导航 消息到渲染进程
- 渲染进程节后到消息 然后准备 HTML 数据 接收数据的方式是直接个网络进程建立数据管道
- 渲染进程会向浏览器进程确认提交
- 浏览器进程接收到渲染进程的消息之后 移除旧的文档 然后更新浏览器进程中的状态

### 页面的展示

1、用户的输入

- 判断地址栏是否是搜索内容 还是请求的 URL
  - 搜索内容的话 就是搜索关键字
  - 如果是符合 URL 规则的话 合成完整的 URL

2、URL 的请求过程

- 首先网络进程查找本地的魂村是否缓存了该资源

  - 缓存了 直接返回资源给浏览器进程
  - 如果在缓存中没有查找到 直接进入网络请求的流程

- 请求前的第一步就是进行 DNS 解析 然后获取请求域名的服务器 IP 地址如果是 HTTPS 还需要建立 TLS 连接

- 利用 IP 地址和服务器建立`TCP`连接

- 浏览器端构建请求行、请求头信息 并把和该域名相关的 Cookie 等数据附加到请求头中 然后向服务器发送构建的请求信息
- 服务器接收请求信息 根据请求信息生成响应的数据（响应行、响应头、响应体）
- 网络进程进行解析响应头的内容
- 重定向
  - 接收到服务器的响应头，网络进程开始解析响应头
    - 301/302 重定向其他的 URL **有一个地址 是 Locatiopn 字段**
- 响应数据的处理
  - `Content-Type` ：告诉浏览器服务器返回的响应体数据是什么类型

3、准备渲染进程

默认情况下 Chrome 会为每个页面分配渲染进程 ，有的是多个页面运行在同一个渲染进程中。

- Chrome 默认策略是，每个标签对应一个渲染进程，从一个页面打开了另一个新的页面 新页面和当前页面属于同一站点的话 新页面会复用父页面的渲染进程
- 渲染进程策略：
  - 通常情况下 打开新的页面都会使用单独的进程
  - A 和 B 属于同一站点的话 那么 B 页面复用 A 页面的渲染进程 如果是其他情况的话 浏览器进程则会为 B 创建一个新的渲染进程

4、提交文档

浏览器进程将网络进程接收到的 HTML 数据提交给渲染进程

5、渲染阶段

- 一旦文档被提交 渲染进程便开始解析和子资源的加载
